<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CHIPS Tracker">
    <meta name="description" content="Online Casino Income Tracker - CHIPS VER2">
    
    <title>CHIPS | Income Tracker v2</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    <link rel="icon" type="image/png" href="assets/icon-192.png">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@400;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Flatpickr Calendar -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
</head>
<body>
    <!-- Main App -->
    <div id="app" class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-btn" id="menuBtn">
                    <span></span><span></span><span></span>
                </button>
                <h1 class="logo">CHIPS<span class="version">v2</span></h1>
            </div>
            <div class="header-right">
                <div class="sync-status" id="syncStatus">
                    <span class="sync-dot"></span>
                    <span class="sync-text">Ready</span>
                </div>
                <button class="refresh-btn" id="refreshBtn" title="Sync Data">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Navigation Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-info">
                    <div class="avatar">üé≤</div>
                    <div class="user-details">
                        <span class="user-name">CHIPS Admin</span>
                        <span class="user-role">Full Access</span>
                    </div>
                </div>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-tab="dashboard">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Dashboard</span>
                </li>
                <li class="nav-item" data-tab="income">
                    <span class="nav-icon">üí∞</span>
                    <span class="nav-text">Income Tracker</span>
                </li>
                <li class="nav-item" data-tab="weekly">
                    <span class="nav-icon">üìÖ</span>
                    <span class="nav-text">Weekly Summary</span>
                </li>
                <li class="nav-item" data-tab="team">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">Team 50%</span>
                </li>
                <li class="nav-item" data-tab="sitefund">
                    <span class="nav-icon">üè¶</span>
                    <span class="nav-text">Site Fund 35%</span>
                </li>
                <li class="nav-item" data-tab="savings">
                    <span class="nav-icon">üê∑</span>
                    <span class="nav-text">Savings 15%</span>
                </li>
                <li class="nav-item" data-tab="retained">
                    <span class="nav-icon">üíº</span>
                    <span class="nav-text">Retained</span>
                </li>
            </ul>
            <div class="sidebar-footer">
                <button class="settings-btn" id="settingsBtn">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-text">Settings</span>
                </button>
            </div>
        </nav>

        <!-- Overlay for mobile sidebar -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Tab -->
            <section class="tab-content active" id="tab-dashboard">
                <div class="page-header">
                    <h2 class="page-title">Dashboard</h2>
                    <p class="page-subtitle">Overview ng performance mo</p>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card gold">
                        <div class="stat-icon">üíµ</div>
                        <div class="stat-info">
                            <span class="stat-label">Total Net Profit</span>
                            <span class="stat-value" id="totalProfit">‚Ç±0</span>
                        </div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-info">
                            <span class="stat-label">Total GGR</span>
                            <span class="stat-value" id="totalGGR">‚Ç±0</span>
                        </div>
                    </div>
                    <div class="stat-card blue">
                        <div class="stat-icon">üé∞</div>
                        <div class="stat-info">
                            <span class="stat-label">Chips Remaining</span>
                            <span class="stat-value" id="totalChips">0</span>
                        </div>
                    </div>
                    <div class="stat-card purple">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-info">
                            <span class="stat-label">Average ROI</span>
                            <span class="stat-value" id="avgROI">0%</span>
                        </div>
                    </div>
                </div>

                <!-- Chart Section -->
                <div class="chart-section">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Weekly Performance</h3>
                            <div class="chart-legend">
                                <span class="legend-item profit"><span class="dot"></span> Profit</span>
                                <span class="legend-item loss"><span class="dot"></span> Loss</span>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="weeklyChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Distribution Summary -->
                <div class="distribution-section">
                    <h3 class="section-title">Fund Distribution</h3>
                    <div class="distribution-grid-4">
                        <div class="dist-card">
                            <div class="dist-header">
                                <span class="dist-icon">üë•</span>
                                <span class="dist-title">Team</span>
                            </div>
                            <div class="dist-percent">50%</div>
                            <div class="dist-amount" id="teamTotal">‚Ç±0</div>
                        </div>
                        <div class="dist-card">
                            <div class="dist-header">
                                <span class="dist-icon">üè¶</span>
                                <span class="dist-title">Site Fund</span>
                            </div>
                            <div class="dist-percent">35%</div>
                            <div class="dist-amount" id="siteFundTotal">‚Ç±0</div>
                        </div>
                        <div class="dist-card">
                            <div class="dist-header">
                                <span class="dist-icon">üíº</span>
                                <span class="dist-title">Retained</span>
                            </div>
                            <div class="dist-percent">20%</div>
                            <div class="dist-amount" id="retainedTotal">‚Ç±0</div>
                        </div>
                        <div class="dist-card">
                            <div class="dist-header">
                                <span class="dist-icon">üê∑</span>
                                <span class="dist-title">Savings</span>
                            </div>
                            <div class="dist-percent">15%</div>
                            <div class="dist-amount" id="savingsTotal">‚Ç±0</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="recent-section">
                    <h3 class="section-title">Recent Activity</h3>
                    <div class="recent-list" id="recentActivity">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </section>

            <!-- Income Tracker Tab -->
            <section class="tab-content" id="tab-income">
                <div class="page-header">
                    <h2 class="page-title">Income Tracker</h2>
                    <p class="page-subtitle">Daily shift-based income tracking</p>
                    <div class="add-btn-group">
                        <button class="add-btn" id="addCFRBtn">
                            <span>+</span> CFR Entry
                        </button>
                        <button class="add-btn secondary" id="addExpenseBtn">
                            <span>+</span> Other Expenses
                        </button>
                    </div>
                </div>

                <!-- Summary Stats -->
                <div class="mini-stats">
                    <div class="mini-stat">
                        <span class="mini-label">Last Net Chips</span>
                        <span class="mini-value" id="lastNetChips">0</span>
                    </div>
                    <div class="mini-stat highlight-stat">
                        <span class="mini-label">Total CFR</span>
                        <span class="mini-value positive" id="totalCFR">‚Ç±0</span>
                    </div>
                    <div class="mini-stat highlight-stat">
                        <span class="mini-label">Total Expenses</span>
                        <span class="mini-value negative" id="totalExpenses">‚Ç±0</span>
                    </div>
                </div>

                <!-- Compact Date Filter Below Stats -->
                <div class="date-filter-bar">
                    <span class="filter-icon">üìÖ</span>
                    <input type="text" class="filter-input" id="filterStartDate" placeholder="Start" readonly>
                    <span class="filter-dash">‚Äì</span>
                    <input type="text" class="filter-input" id="filterEndDate" placeholder="End" readonly>
                    <button class="filter-btn-sm apply" id="applyFilterBtn" title="Apply Filter">‚úì</button>
                    <button class="filter-btn-sm reset" id="resetFilterBtn" title="Reset to 7 Days">‚Ü∫</button>
                </div>

                <!-- Tabs for CFR and Expenses -->
                <div class="sub-tabs">
                    <button class="sub-tab active" data-subtab="cfr">üí∞ CFR Entries</button>
                    <button class="sub-tab" data-subtab="expenses">üìã Other Expenses</button>
                </div>

                <!-- CFR Table -->
                <div class="sub-tab-content active" id="subtab-cfr">
                    <div class="cfr-grouped-container" id="cfrGroupedContainer">
                        <!-- Populated by JS - grouped by date -->
                    </div>
                </div>

                <!-- Expenses Table -->
                <div class="sub-tab-content" id="subtab-expenses">
                    <div class="table-container">
                        <table class="data-table" id="expensesTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Total Expenses</th>
                                    <th>Details</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="expensesTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Weekly Summary Tab -->
            <section class="tab-content" id="tab-weekly">
                <div class="page-header">
                    <h2 class="page-title">Weekly Summary</h2>
                    <p class="page-subtitle">Weekly cutoff performance data</p>
                    <button class="add-btn" id="addWeeklyBtn">
                        <span>+</span> New Cutoff
                    </button>
                </div>

                <div class="table-container">
                    <table class="data-table" id="weeklyTable">
                        <thead>
                            <tr>
                                <th>Start</th>
                                <th>End</th>
                                <th>GGR</th>
                                <th>Loader</th>
                                <th>Expenses</th>
                                <th>Net Profit</th>
                                <th>ROI %</th>
                                <th>Status</th>
                                <th>Team 50%</th>
                                <th>Site 35%</th>
                                <th>Retained 20%</th>
                                <th>Savings 15%</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="weeklyTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Team 50% Tab -->
            <section class="tab-content" id="tab-team">
                <div class="page-header">
                    <h2 class="page-title">Team 50%</h2>
                    <p class="page-subtitle">Track team share (Myca & Mark)</p>
                </div>

                <!-- Summary Card -->
                <div class="fund-summary">
                    <div class="fund-stat">
                        <span class="fund-label">Total Allocated</span>
                        <span class="fund-value positive" id="teamAllocated">‚Ç±0</span>
                    </div>
                    <div class="fund-stat">
                        <span class="fund-label">Total Withdrawn</span>
                        <span class="fund-value negative" id="teamWithdrawn">‚Ç±0</span>
                    </div>
                    <div class="fund-stat">
                        <span class="fund-label">Remaining Balance</span>
                        <span class="fund-value" id="teamRemaining">‚Ç±0</span>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table" id="teamTable">
                        <thead>
                            <tr>
                                <th>Start</th>
                                <th>End</th>
                                <th>Net Profit</th>
                                <th>Team 50%</th>
                                <th>Withdrawn</th>
                                <th>Remaining</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="teamTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Site Fund Tab -->
            <section class="tab-content" id="tab-sitefund">
                <div class="page-header">
                    <h2 class="page-title">Site Fund 35%</h2>
                    <p class="page-subtitle">Track site fund allocation and expenses</p>
                </div>

                <!-- Summary Card -->
                <div class="fund-summary">
                    <div class="fund-stat">
                        <span class="fund-label">Total Allocated</span>
                        <span class="fund-value positive" id="siteFundAllocated">‚Ç±0</span>
                    </div>
                    <div class="fund-stat">
                        <span class="fund-label">Total Spent</span>
                        <span class="fund-value negative" id="siteFundSpent">‚Ç±0</span>
                    </div>
                    <div class="fund-stat">
                        <span class="fund-label">Remaining Balance</span>
                        <span class="fund-value" id="siteFundRemaining">‚Ç±0</span>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table" id="siteFundTable">
                        <thead>
                            <tr>
                                <th>Start</th>
                                <th>End</th>
                                <th>Net Profit</th>
                                <th>Site Fund 35%</th>
                                <th>Spent</th>
                                <th>Remaining</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="siteFundTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Retained Tab -->
            <section class="tab-content" id="tab-retained">
                <div class="page-header">
                    <h2 class="page-title">Retained</h2>
                    <p class="page-subtitle">Track retained funds for bills and utilities</p>
                </div>

                <!-- Summary Card -->
                <div class="fund-summary">
                    <div class="fund-stat">
                        <span class="fund-label">Total Retained</span>
                        <span class="fund-value positive" id="retainedAllocated">‚Ç±0</span>
                    </div>
                    <div class="fund-stat">
                        <span class="fund-label">Total Spent</span>
                        <span class="fund-value negative" id="retainedSpent">‚Ç±0</span>
                    </div>
                    <div class="fund-stat">
                        <span class="fund-label">Remaining Balance</span>
                        <span class="fund-value" id="retainedRemaining">‚Ç±0</span>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table" id="retainedTable">
                        <thead>
                            <tr>
                                <th>Start</th>
                                <th>End</th>
                                <th>Net Profit</th>
                                <th>Retained 20%</th>
                                <th>Spent</th>
                                <th>Remaining</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="retainedTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Savings Tab -->
            <section class="tab-content" id="tab-savings">
                <div class="page-header">
                    <h2 class="page-title">Savings 15%</h2>
                    <p class="page-subtitle">Track savings allocation</p>
                </div>

                <!-- Summary Card -->
                <div class="fund-summary">
                    <div class="fund-stat">
                        <span class="fund-label">Total Savings</span>
                        <span class="fund-value positive" id="savingsAllocated">‚Ç±0</span>
                    </div>
                    <div class="fund-stat">
                        <span class="fund-label">Total Withdrawn</span>
                        <span class="fund-value negative" id="savingsWithdrawn">‚Ç±0</span>
                    </div>
                    <div class="fund-stat">
                        <span class="fund-label">Current Balance</span>
                        <span class="fund-value" id="savingsBalance">‚Ç±0</span>
                    </div>
                </div>

                <div class="table-container">
                    <table class="data-table" id="savingsTable">
                        <thead>
                            <tr>
                                <th>Start</th>
                                <th>End</th>
                                <th>Net Profit</th>
                                <th>Savings 15%</th>
                                <th>Withdrawn</th>
                                <th>Remaining</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="savingsTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="bottom-nav">
            <button class="bottom-nav-item active" data-tab="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Dashboard</span>
            </button>
            <button class="bottom-nav-item" data-tab="income">
                <span class="nav-icon">üí∞</span>
                <span class="nav-label">Income</span>
            </button>
            <button class="bottom-nav-item" data-tab="weekly">
                <span class="nav-icon">üìÖ</span>
                <span class="nav-label">Weekly</span>
            </button>
            <button class="bottom-nav-item" data-tab="team">
                <span class="nav-icon">üë•</span>
                <span class="nav-label">Funds</span>
            </button>
        </nav>
    </div>

    <!-- CFR Entry Modal -->
    <div class="modal-overlay" id="cfrModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title" id="cfrModalTitle">Add CFR Entry</h3>
                <button class="modal-close" onclick="app.closeCFRModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="cfrForm">
                    <input type="hidden" id="cfrRowIndex">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" class="form-input" id="cfrDate" required>
                        </div>
                        <div class="form-group">
                            <label>Shift Time</label>
                            <select class="form-select" id="cfrShift" required>
                                <option value="12:00PM to 8:00PM">12:00PM to 8:00PM</option>
                                <option value="8:00PM to 4:00AM">8:00PM to 4:00AM</option>
                                <option value="4:00AM to 12:00PM">4:00AM to 12:00PM</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4 class="form-section-title">üíµ Cash For Remittance</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>CFR / CHIPS OUT</label>
                                <input type="text" class="form-input amount-input" id="cfrAmount" placeholder="0" required>
                            </div>
                            <div class="form-group">
                                <label>Loader Salary</label>
                                <input type="text" class="form-input amount-input" id="cfrLoaderSalary" placeholder="0" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4 class="form-section-title">üé∞ Chips In (Multiple)</h4>
                        <div class="auto-fill-notice" id="autoFillNotice">
                            <span>‚ú® Auto-filled from last Net Chips: <strong id="autoFillValue">0</strong></span>
                        </div>
                        <div class="multi-input-list" id="chipsInList">
                            <!-- Dynamic items -->
                        </div>
                        <div class="multi-input-add">
                            <input type="text" class="form-input amount-input" id="newChipsInAmount" placeholder="Amount">
                            <input type="text" class="form-input" id="newChipsInRemarks" placeholder="Remarks (e.g. Added chips)">
                            <button type="button" class="btn btn-small btn-add" onclick="app.addChipsInItem()">+ Add</button>
                        </div>
                        <div class="calculated-field">
                            <span>Total Chips In:</span>
                            <span class="calculated-value" id="totalChipsIn">0</span>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4 class="form-section-title">üé∞ Ending Chips</h4>
                        <div class="form-group">
                            <label>Ending Chips Balance</label>
                            <input type="text" class="form-input amount-input" id="endingChips" placeholder="0" required>
                            <small class="form-hint">Enter the chips balance at end of shift</small>
                        </div>
                    </div>

                    <div class="form-section highlight">
                        <div class="calculated-field large">
                            <span>NET CHIPS:</span>
                            <span class="calculated-value" id="calculatedNetChips">0</span>
                        </div>
                        <small class="formula">= Ending Chips</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeCFRModal()">Cancel</button>
                <button class="btn btn-primary" onclick="app.saveCFREntry()">üíæ Save Entry</button>
            </div>
        </div>
    </div>

    <!-- Other Expenses Entry Modal -->
    <div class="modal-overlay" id="otherExpensesModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title" id="otherExpensesModalTitle">Add Other Expenses</h3>
                <button class="modal-close" onclick="app.closeOtherExpensesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="otherExpensesForm">
                    <input type="hidden" id="otherExpensesRowIndex">
                    
                    <div class="form-group">
                        <label>Date</label>
                        <input type="text" class="form-input" id="otherExpensesDate" placeholder="Select date" required readonly>
                    </div>

                    <div class="form-section">
                        <h4 class="form-section-title">üìã Other Expenses (Multiple)</h4>
                        <div class="multi-input-list" id="otherExpensesList">
                            <!-- Dynamic items -->
                        </div>
                        <div class="multi-input-add three-col">
                            <input type="text" class="form-input amount-input" id="newExpenseAmount" placeholder="Amount">
                            <input type="text" class="form-input amount-input" id="newExpenseFees" placeholder="Fees">
                            <input type="text" class="form-input" id="newExpenseRemarks" placeholder="Remarks">
                            <button type="button" class="btn btn-small btn-add" onclick="app.addExpenseItem()">+ Add</button>
                        </div>
                    </div>

                    <div class="form-section highlight">
                        <div class="calculated-field large">
                            <span>TOTAL EXPENSES:</span>
                            <span class="calculated-value negative" id="totalOtherExpenses">‚Ç±0</span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeOtherExpensesModal()">Cancel</button>
                <button class="btn btn-primary" onclick="app.saveOtherExpensesEntry()">üíæ Save Expenses</button>
            </div>
        </div>
    </div>

    <!-- Weekly Summary Modal -->
    <div class="modal-overlay" id="weeklyModal">
        <div class="modal modal-large">
            <div class="modal-header">
                <h3 class="modal-title">New Weekly Cutoff</h3>
                <button class="modal-close" onclick="app.closeWeeklyModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="weeklyForm">
                    <input type="hidden" id="weeklyRowIndex">
                    
                    <div class="form-section">
                        <h4 class="form-section-title">üìÖ Cutoff Period</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Start Date</label>
                                <input type="text" class="form-input" id="weeklyStart" placeholder="Select date" required readonly>
                            </div>
                            <div class="form-group">
                                <label>End Date</label>
                                <input type="text" class="form-input" id="weeklyEnd" placeholder="Select date" required readonly>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary btn-full" onclick="app.calculateFromDates()">
                            üîÑ Calculate from Income Tracker
                        </button>
                    </div>

                    <div class="form-section">
                        <h4 class="form-section-title">üí∞ Revenue & Expenses</h4>
                        <div class="form-group">
                            <label>GGR (Gross Gaming Revenue)</label>
                            <input type="text" class="form-input amount-input" id="weeklyGGR" placeholder="Enter GGR from casino site" required>
                            <small class="form-hint">This is the 1-week cutoff sales from the casino site</small>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Loader Salary</label>
                                <input type="text" class="form-input" id="weeklyLoaderSalary" placeholder="0" readonly>
                            </div>
                            <div class="form-group">
                                <label>Other Expenses</label>
                                <input type="text" class="form-input" id="weeklyOtherExp" placeholder="0" readonly>
                            </div>
                        </div>
                    </div>

                    <div class="form-section highlight">
                        <div class="calculated-grid">
                            <div class="calc-item">
                                <span class="calc-label">Net Profit</span>
                                <span class="calc-value" id="calcNetProfit">‚Ç±0</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">ROI</span>
                                <span class="calc-value" id="calcROI">0%</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">Status</span>
                                <span class="calc-value" id="calcStatus">-</span>
                            </div>
                        </div>
                        <hr class="divider">
                        <h4 style="text-align: center; margin-bottom: 12px;">Distribution Breakdown</h4>
                        <div class="calc-item" style="text-align: center; margin-bottom: 12px; padding: 8px; background: rgba(255,215,0,0.1); border-radius: 8px;">
                            <span class="calc-label">Retained 20%</span>
                            <span class="calc-value" id="calcRetained20" style="color: var(--gold);">‚Ç±0</span>
                        </div>
                        <div class="calc-item" style="text-align: center; margin-bottom: 12px; padding: 8px; background: rgba(0,255,136,0.1); border-radius: 8px;">
                            <span class="calc-label">For Distribution 80%</span>
                            <span class="calc-value" id="calcDist80" style="color: var(--green);">‚Ç±0</span>
                        </div>
                        <p style="text-align: center; font-size: 12px; color: var(--text-muted); margin-bottom: 12px;">‚Üì From Distribution 80% ‚Üì</p>
                        <div class="calculated-grid">
                            <div class="calc-item">
                                <span class="calc-label">Team 50%</span>
                                <span class="calc-value" id="calcTeam50">‚Ç±0</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">Site Fund 35%</span>
                                <span class="calc-value" id="calcSite35">‚Ç±0</span>
                            </div>
                            <div class="calc-item">
                                <span class="calc-label">Savings 15%</span>
                                <span class="calc-value" id="calcSavings15">‚Ç±0</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeWeeklyModal()">Cancel</button>
                <button class="btn btn-primary" onclick="app.saveWeeklySummary()">üíæ Save Cutoff</button>
            </div>
        </div>
    </div>

    <!-- Add Expense/Withdrawal Modal (for fund tabs) -->
    <div class="modal-overlay" id="fundExpenseModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="fundExpenseModalTitle">Add Expense</h3>
                <button class="modal-close" onclick="app.closeFundExpenseModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="fundExpenseForm">
                    <input type="hidden" id="fundExpenseSheetName">
                    <input type="hidden" id="fundExpenseRowIndex">
                    
                    <div class="form-group">
                        <label>Amount (‚Ç±)</label>
                        <input type="number" class="form-input" id="fundExpenseAmount" step="0.01" placeholder="0" required>
                    </div>
                    <div class="form-group">
                        <label>Remarks</label>
                        <input type="text" class="form-input" id="fundExpenseRemarks" placeholder="e.g. Groceries, Bill Payment" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeFundExpenseModal()">Cancel</button>
                <button class="btn btn-primary" onclick="app.saveFundExpense()">üíæ Add</button>
            </div>
        </div>
    </div>

    <!-- View Details Modal -->
    <div class="modal-overlay" id="viewDetailsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Details</h3>
                <button class="modal-close" onclick="app.closeViewDetailsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="details-list" id="detailsList">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeViewDetailsModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsOverlay">
        <div class="modal settings-modal">
            <div class="modal-header">
                <h3 class="modal-title">‚öôÔ∏è Settings</h3>
                <button class="modal-close" id="settingsClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4>Google Apps Script Connection</h4>
                    <div class="form-group">
                        <label>Web App URL</label>
                        <input type="text" id="webAppUrl" class="form-input" placeholder="https://script.google.com/macros/s/.../exec">
                        <small class="form-hint">Deploy your Google Apps Script as a Web App and paste the URL here</small>
                    </div>
                    <button class="btn btn-primary" id="testConnection">üîó Test Connection</button>
                </div>
                <div class="settings-section">
                    <h4>Display Settings</h4>
                    <div class="form-group">
                        <label class="toggle-label">
                            <span>Auto-sync (every 30 sec)</span>
                            <input type="checkbox" id="autoSync" checked>
                            <span class="toggle-switch"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-section">
                    <h4>System</h4>
                    <div class="form-group">
                        <button class="btn btn-refresh" id="hardRefreshBtn">üîÑ Hard Refresh</button>
                        <small class="form-hint">Clear cache and reload the app (Ctrl+Shift+R)</small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="settingsCancel">Cancel</button>
                <button class="btn btn-primary" id="settingsSave">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Flatpickr Calendar -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <!-- App Scripts -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW failed:', err));
            });
        }
    </script>
</body>
</html>
